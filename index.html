<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>×¨××œ×™ ××˜×•"×¡ - ××¢×¨×›×ª ×œ××™×“×” ××™×©×™×ª 2026</title>
    
    <style>
        /* =========================================
           ×”×’×“×¨×•×ª ×‘×¡×™×¡×™×•×ª (Root & Reset)
           ========================================= */
        :root {
            /* ×¤×œ×˜×ª ×¦×‘×¢×™× ×™×•×§×¨×ª×™×ª */
            --bg-deep: #0f172a;
            --accent-main: #6366f1; /* ×¡×’×•×œ ××™× ×“×™×’×• */
            --success: #10b981;    /* ×™×¨×•×§ ×‘×¨×§×ª */
            --warning: #f59e0b;    /* ×›×ª×•× ××–×”×¨×” */
            --danger: #ef4444;     /* ××“×•× */
            --glass: rgba(255, 255, 255, 0.1);
            --glass-strong: rgba(255, 255, 255, 0.2);
            --glass-border: rgba(255, 255, 255, 0.15);
            
            /* ×¦×‘×¢×™ ×™××™× ×œ××¢×¨×›×ª ×”×©×¢×•×ª */
            --day-sun: #fbbf24;
            --day-mon: #f87171;
            --day-tue: #34d399;
            --day-wed: #60a5fa;
            --day-thu: #c084fc;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            direction: rtl;
            background: var(--bg-deep);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
            /* ×¨×§×¢ ×’×¨×“×™×× ×˜ ×“×™× ××™ */
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
        }

        /* =========================================
           ×× ×™××¦×™×•×ª (Animations)
           ========================================= */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        /* =========================================
           ××›×•×œ×•×ª ×¨××©×™×•×ª (Layout)
           ========================================= */
        .app-container {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            z-index: 10;
        }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: fadeIn 0.6s ease-out;
        }

        /* =========================================
           ××¢×¨×›×ª ×”× ×™×§×•×“ ×•×”×¡×˜×˜×™×¡×˜×™×§×” (Dashboard)
           ========================================= */
        .stats-card {
            margin-bottom: 20px;
        }

        .points-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .points-box {
            font-size: 26px;
            font-weight: 900;
            background: linear-gradient(to left, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--success), #34d399);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* =========================================
           ×›×¤×ª×•×¨×™× (Buttons)
           ========================================= */
        .btn-primary {
            width: 100%;
            padding: 20px;
            border-radius: 20px;
            border: none;
            background: white;
            color: var(--bg-deep);
            font-weight: 800;
            font-size: 18px;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-focus {
            background: linear-gradient(135deg, var(--accent-main), #4f46e5);
            color: white;
            padding: 22px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: 900;
            margin: 25px 0;
            animation: pulseGlow 2s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            border: none;
            cursor: pointer;
            width: 100%;
        }

        .btn-focus:active { transform: scale(0.97); }

        /* =========================================
           ×›×¨×˜×™×¡×™×•×ª ××©×™××•×ª (Task Cards)
           ========================================= */
        .task-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 18px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .task-card:hover { transform: translateY(-3px); background: rgba(255,255,255,0.09); }

        .task-title { font-size: 22px; font-weight: 800; margin-bottom: 6px; }
        .task-deadline { font-size: 13px; color: var(--warning); font-weight: 600; margin-bottom: 15px; }

        .task-img { width: 100%; border-radius: 18px; margin-bottom: 15px; cursor: zoom-in; }

        /* =========================================
           ××¦×‘ ×¨×™×›×•×– (Focus Overlay)
           ========================================= */
        #focusOverlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 15, 30, 0.98);
            backdrop-filter: blur(25px);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .timer-display {
            font-size: 90px;
            font-weight: 900;
            margin: 15px 0;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }

        .yt-frame-container {
            width: 100%;
            max-width: 800px;
            height: 350px;
            border-radius: 25px;
            overflow: hidden;
            border: 2px solid var(--glass-border);
            background: #000;
            margin-bottom: 25px;
        }

        /* ×”××©×™××•×ª ×‘×ª×•×š ××¦×‘ ×œ××™×“×” - ××™×•×Ÿ ×•×¡×“×¨ */
        .focus-tasks-list {
            width: 100%;
            max-width: 480px;
            margin-bottom: 100px;
        }

        .focus-mini-card {
            background: rgba(255, 255, 255, 0.08);
            border-right: 6px solid var(--accent-main);
            border-radius: 18px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.4s ease-out;
        }

        .mini-card-info b { font-size: 17px; display: block; }
        .mini-card-info span { font-size: 12px; color: var(--warning); font-weight: bold; }

        /* ×›×¤×ª×•×¨ ×™×¦×™××” */
        .exit-focus-btn {
            position: fixed;
            bottom: 30px;
            background: var(--danger);
            color: white;
            padding: 18px 40px;
            border-radius: 20px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .hidden { display: none !important; }
    </style>
    <body>

<div id="focusConfigModal" class="hidden" style="position:fixed; inset:0; background:rgba(10,15,30,0.96); z-index:10000; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(15px);">
    <div class="glass-panel" style="width:90%; max-width:400px; text-align:center; border: 1px solid var(--accent-main);">
        <h2 style="font-size:30px; margin-bottom:10px;">ğŸš€ ×”×ª×—×œ×ª ×¨×™×›×•×–</h2>
        <p style="opacity:0.7; margin-bottom:25px;">×”×’×“×¨ ××ª ×”×™×¢×“×™× ×©×œ×š ×œ×¡×©×Ÿ ×”× ×•×›×—×™</p>
        
        <div style="text-align:right; margin-bottom:20px;">
            <label style="font-size:14px; margin-bottom:8px; display:block; padding-right:5px;">×›××” ×“×§×•×ª ×ª×¨×¦×” ×œ×œ××•×“?</label>
            <input type="number" id="focusMinsInput" value="25" style="width:100%; padding:18px; border-radius:15px; border:none; background:rgba(255,255,255,0.08); color:white; font-size:18px; outline:none; text-align:center;">
        </div>

        <div style="text-align:right; margin-bottom:30px;">
            <label style="font-size:14px; margin-bottom:8px; display:block; padding-right:5px;">×‘×—×¨ ×¡×’× ×•×Ÿ ×©×¢×•×Ÿ:</label>
            <select id="focusColorTheme" style="width:100%; padding:18px; border-radius:15px; border:none; background:rgba(255,255,255,0.08); color:white; font-size:18px; outline:none;">
                <option value="#6366f1">×¡×’×•×œ ××™× ×“×™×’×• (×¨×™×›×•×– ×¢××•×§)</option>
                <option value="#10b981">×™×¨×•×§ ×‘×¨×§×ª (×™×¦×™×¨×ª×™×•×ª)</option>
                <option value="#fbbf24">×¦×”×•×‘ ×–×”×‘ (×× ×¨×’×™×”)</option>
                <option value="#f8fafc">×œ×‘×Ÿ ×©×œ×’ (×©×§×˜)</option>
            </select>
        </div>

        <button class="btn-primary" style="background:var(--accent-main); color:white; font-size:20px;" onclick="initiateFocusMode()">×¦× ×œ×“×¨×š!</button>
        <button onclick="closeFocusSetup()" style="background:none; border:none; color:white; margin-top:20px; opacity:0.5; cursor:pointer; font-size:14px;">×—×–×•×¨ ×œ××©×™××•×ª</button>
    </div>
</div>

<div class="app-container">
    
    <div id="loginView" class="glass-panel">
        <h1 style="font-size:48px; text-align:center; margin-bottom:5px; letter-spacing:-2px; font-weight:900;">×¨××œ×™ ××˜×•"×¡</h1>
        <p style="text-align:center; opacity:0.5; margin-bottom:40px; font-size:18px;">Student Management System</p>
        
        <div style="margin-bottom:15px;">
            <input type="text" id="inputName" placeholder="×©× ××œ× ×©×œ ×”×ª×œ××™×“" style="width:100%; padding:22px; border-radius:20px; border:none; background:rgba(255,255,255,0.06); color:white; font-size:18px; box-sizing:border-box; outline:none;">
        </div>
        <div style="margin-bottom:30px;">
            <input type="text" id="inputClass" placeholder="×§×•×“ ×›×™×ª×” (A1, B2...)" style="width:100%; padding:22px; border-radius:20px; border:none; background:rgba(255,255,255,0.06); color:white; font-size:18px; box-sizing:border-box; outline:none;">
        </div>
        
        <button class="btn-primary" onclick="processLogin()">×”×ª×—×‘×¨ ×œ××¨×›×– ×”×œ××™×“×”</button>
    </div>

    <div id="mainView" class="hidden">
        
        <div class="glass-panel stats-card">
            <div class="points-row">
                <div id="userGreeting" style="font-size:24px; font-weight:800;">×”×™×™, ×˜×•×¢×Ÿ...</div>
                <div class="points-box" id="pointsVal">ğŸ’° 0</div>
            </div>
            
            <div style="display:flex; justify-content:space-between; font-size:12px; opacity:0.7; margin-bottom:8px;">
                <span>×™×¢×“ ×¨×™×›×•×– ×™×•××™ (×“×§×•×ª)</span>
                <span id="focusProgressText">0 / 60</span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="dailyBar"></div>
            </div>
        </div>

        <button class="btn-focus" onclick="openFocusSetup()">
            <span>âš¡</span> ×›× ×™×¡×” ×œ××¦×‘ ×œ××™×“×” ×•××•×–×™×§×”
        </button>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding:0 10px;">
            <h2 style="margin:0; font-size:22px;">×”××©×™××•×ª ×©×œ×™</h2>
            <div style="cursor:pointer; font-size:13px; background:var(--glass-strong); padding:8px 15px; border-radius:12px; font-weight:bold;" onclick="toggleSchedule()">ğŸ“… ××¢×¨×›×ª ×©×¢×•×ª</div>
        </div>
        
        <div id="activeTasksList">
            </div>

        <div id="completedTasksArea" class="hidden">
            <h3 style="margin:45px 0 15px 0; opacity:0.5; font-size:15px; padding-right:10px;">××©×™××•×ª ×©×”×¡×ª×™×™××• âœ…</h3>
            <div id="doneTasksList" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"></div>
        </div>

        <div style="text-align:center; margin:60px 0 20px 0; opacity:0.3; font-size:12px; cursor:pointer; text-decoration:underline;" onclick="doLogout()">×”×ª× ×ª×§×•×ª ××”××¢×¨×›×ª</div>
    </div>
</div>

<div id="focusOverlay">
    <div class="timer-display" id="timerDigits">00:00</div>
    
    <div class="yt-frame-container">
        <div style="display:flex; background:#111; padding:12px; border-bottom:1px solid #333;">
            <input type="text" id="ytQuery" placeholder="×—×¤×© ××•×–×™×§×” ×œ×œ×™××•×“×™×..." style="flex:1; background:#222; border:none; color:white; padding:10px 15px; border-radius:10px; font-size:14px; outline:none;">
            <button onclick="handleYTSearch()" style="background:var(--accent-main); border:none; color:white; padding:0 20px; border-radius:10px; margin-right:8px; font-weight:bold; cursor:pointer;">×—×™×¤×•×©</button>
        </div>
        <iframe id="focusIframe" width="100%" height="100%" src="https://www.youtube.com/embed?enablejsapi=1&origin=https://www.youtube.com" frameborder="0"></iframe>
    </div>

    <div class="focus-tasks-list">
        <h3 style="text-align:center; color:var(--success); margin-bottom:20px; font-size:18px;">×”××©×™××•×ª ×©×œ×š ×œ×‘×™×¦×•×¢ (×œ×¤×™ ×“×—×™×¤×•×ª):</h3>
        <div id="focusMiniTaskList">
            </div>
    </div>

    <button class="exit-focus-btn" onclick="terminateFocusMode()">×¡×™×™× ×¡×©×Ÿ ×œ××™×“×” ×•×¦× âŒ</button>
</div>

<div id="imageZoomModal" class="hidden" style="position:fixed; inset:0; z-index:11000; background:rgba(0,0,0,0.95); display:flex; align-items:center; justify-content:center;" onclick="this.classList.add('hidden')">
    <img id="zoomedImg" src="" style="max-width:95%; max-height:95%; border-radius:10px; box-shadow:0 0 40px rgba(0,0,0,0.5);">
</div>

<div id="scheduleModal" class="hidden" style="position:fixed; inset:0; z-index:10500; background:rgba(10,15,30,0.98); padding:30px; overflow-y:auto;" onclick="this.classList.add('hidden')">
    <div id="scheduleContent" onclick="event.stopPropagation()"></div>
    <button class="btn-primary" style="background:var(--danger); color:white; margin-top:30px; max-width:200px; display:block; margin-left:auto; margin-right:auto;">×¡×’×•×¨ ××¢×¨×›×ª</button>
</div>
</head>
<script>
    // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
    let currentUser = null;
    let tasks = [];
    let focusTimer = null;
    let secondsLeft = 0;
    let points = 0;
    let dailyFocusMinutes = 0;

    // --- 1. ×¤×•× ×§×¦×™×™×ª ××™×•×Ÿ ×”××©×™××•×ª ×”×§×¨×™×˜×™×ª ---
    function sortTasksByDeadline(taskArray) {
        return taskArray.sort((a, b) => {
            // ×”×¤×™×›×ª ×ª××¨×™×›×™× ×œ××•×‘×™×™×§×˜ Date ×œ×”×©×•×•××”
            // ×¤×•×¨××˜ ××¦×•×¤×”: YYYY-MM-DD
            const dateA = new Date(a.deadline);
            const dateB = new Date(b.deadline);
            return dateA - dateB; 
        });
    }

    // --- 2. ×—×™×©×•×‘ ×–××Ÿ × ×•×ª×¨ ×œ×”×’×©×” ---
    function getRemainingTimeText(deadlineStr) {
        const now = new Date();
        const deadline = new Date(deadlineStr);
        const diffInMs = deadline - now;
        
        if (diffInMs < 0) return "×¢×‘×¨ ×–××Ÿ ×”×”×’×©×” âš ï¸";
        
        const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));
        const diffInHours = Math.floor((diffInMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
        if (diffInDays > 0) {
            return `× ×©××¨×• ×¢×•×“ ${diffInDays} ×™××™× ×œ×”×’×©×”`;
        } else if (diffInHours > 0) {
            return `× ×•×ª×¨×• ${diffInHours} ×©×¢×•×ª - ×“×—×•×£! ğŸ”¥`;
        } else {
            return "×œ×”×’×©×” ×”×™×•×! â³";
        }
    }

    // --- 3. ×¨×™× ×“×•×¨ ×¨×©×™××ª ×”××©×™××•×ª ×‘××¦×‘ ×¨×’×™×œ ---
    function renderTasks() {
        const container = document.getElementById('activeTasksList');
        const doneContainer = document.getElementById('doneTasksList');
        const activeTasks = sortTasksByDeadline(tasks.filter(t => !t.completed));
        const completedTasks = tasks.filter(t => t.completed);

        container.innerHTML = '';
        activeTasks.forEach(task => {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.innerHTML = `
                <div class="task-title">${task.title}</div>
                <div class="task-deadline">ğŸ“… ×”×’×©×” ×¢×“: ${task.deadline}</div>
                ${task.img ? `<img src="${task.img}" class="task-img" onclick="zoomImage('${task.img}')">` : ''}
                <button class="btn-primary" onclick="completeTask('${task.id}')" style="padding:12px; font-size:14px; background:rgba(16,185,129,0.2); color:#10b981; border:1px solid #10b981;">×¡×™×™××ª×™ ××ª ×–×” âœ…</button>
            `;
            container.appendChild(card);
        });

        // ×¢×“×›×•×Ÿ ××¨×›×™×•×Ÿ
        if(completedTasks.length > 0) {
            document.getElementById('completedTasksArea').classList.remove('hidden');
            doneContainer.innerHTML = '';
            completedTasks.forEach(task => {
                const mini = document.createElement('div');
                mini.style = "background:rgba(255,255,255,0.03); padding:10px; border-radius:15px; font-size:12px; text-align:center; opacity:0.6;";
                mini.innerHTML = `<b>${task.title}</b><br>×‘×•×¦×¢ âœ¨`;
                doneContainer.appendChild(mini);
            });
        }
    }

    // --- 4. ×¨×™× ×“×•×¨ ×¨×©×™××ª ××©×™××•×ª ×“×—×•×¤×•×ª ×œ××¦×‘ ×œ××™×“×” ---
    function renderFocusTasks() {
        const container = document.getElementById('focusMiniTaskList');
        const activeTasks = sortTasksByDeadline(tasks.filter(t => !t.completed));
        
        container.innerHTML = '';
        activeTasks.forEach(task => {
            const timeInfo = getRemainingTimeText(task.deadline);
            const card = document.createElement('div');
            card.className = 'focus-mini-card';
            card.innerHTML = `
                <div class="mini-card-info">
                    <b>${task.title}</b>
                    <span>${timeInfo}</span>
                </div>
                <button onclick="completeTask('${task.id}'); this.parentElement.style.opacity='0.3'; this.remove();" style="background:none; border:1px solid var(--success); color:var(--success); border-radius:50%; width:30px; height:30px; cursor:pointer;">âœ“</button>
            `;
            container.appendChild(card);
        });
    }

    // --- 5. ×œ×•×’×™×§×ª ×”×˜×™×™××¨ ×•××¦×‘ ×œ××™×“×” ---
    function initiateFocusMode() {
        const mins = document.getElementById('focusMinsInput').value;
        secondsLeft = mins * 60;
        const themeColor = document.getElementById('focusColorTheme').value;
        
        // ×”×’×“×¨×ª ×¢×™×¦×•×‘ ×”××¦×‘
        document.documentElement.style.setProperty('--accent-main', themeColor);
        document.getElementById('timerDigits').style.color = themeColor;
        
        document.getElementById('focusConfigModal').classList.add('hidden');
        document.getElementById('focusOverlay').style.display = 'flex';
        
        renderFocusTasks(); // ×”×¦×’×ª ×”××©×™××•×ª ×”×××•×™× ×•×ª
        startTimer();
    }

    function startTimer() {
        if(focusTimer) clearInterval(focusTimer);
        
        focusTimer = setInterval(() => {
            if(secondsLeft <= 0) {
                clearInterval(focusTimer);
                alert("×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ××ª ×¡×©×Ÿ ×”×œ××™×“×” ğŸ†");
                terminateFocusMode();
                return;
            }
            secondsLeft--;
            updateTimerDisplay();
        }, 1000);
    }

    function updateTimerDisplay() {
        const m = Math.floor(secondsLeft / 60);
        const s = secondsLeft % 60;
        document.getElementById('timerDigits').innerText = 
            `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    }

    function terminateFocusMode() {
        clearInterval(focusTimer);
        document.getElementById('focusOverlay').style.display = 'none';
        // ×”×•×¡×¤×ª × ×§×•×“×•×ª ×•×¢×“×›×•×Ÿ ×’×¨×£ ×™×•××™ (×—×™×©×•×‘ ×–×× ×™)
        addPoints(50);
        renderTasks();
    }

    // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ---
    function zoomImage(src) {
        document.getElementById('zoomedImg').src = src;
        document.getElementById('imageZoomModal').classList.remove('hidden');
    }

    function addPoints(amount) {
        points += amount;
        document.getElementById('pointsVal').innerText = `ğŸ’° ${points}`;
    }
</script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    // --- 1. ×”×’×“×¨×•×ª ×—×™×‘×•×¨ ×œ-Firebase ---
    // ×”×¢×¨×”: ×™×© ×œ×”×—×œ×™×£ ××ª ×”× ×ª×•× ×™× ×›××Ÿ ×‘-Firebase Config ×”×××™×ª×™ ×©×œ ×”×¤×¨×•×™×§×˜ ×©×œ×š
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "rally-matos.firebaseapp.com",
        databaseURL: "https://rally-matos-default-rtdb.firebaseio.com",
        projectId: "rally-matos",
        storageBucket: "rally-matos.appspot.com",
        messagingSenderId: "123456789",
        appId: "1:123456789:web:abcdef"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- 2. ×œ×•×’×™×§×ª ×”×ª×—×‘×¨×•×ª (Login) ---
    function processLogin() {
        const name = document.getElementById('inputName').value.trim();
        const classCode = document.getElementById('inputClass').value.trim().toUpperCase();

        if (name === "" || classCode === "") {
            alert("× × ×œ×”×–×™×Ÿ ×©× ×•×§×•×“ ×›×™×ª×” ×ª×§× ×™");
            return;
        }

        currentUser = { name, classCode };
        document.getElementById('userGreeting').innerText = `×”×™×™, ${name}`;
        document.getElementById('loginView').classList.add('hidden');
        document.getElementById('mainView').classList.remove('hidden');

        // ×˜×¢×™× ×ª × ×ª×•× ×™×
        loadTasks();
        loadUserStats();
    }

    // --- 3. ×˜×¢×™× ×ª ××©×™××•×ª ×‘×–××Ÿ ×××ª ---
    function loadTasks() {
        const tasksRef = db.ref(`classes/${currentUser.classCode}/tasks`);
        tasksRef.on('value', (snapshot) => {
            const data = snapshot.val();
            tasks = [];
            if (data) {
                for (let id in data) {
                    tasks.push({ id, ...data[id] });
                }
            }
            renderTasks();
            // ×× ×× ×—× ×• ×‘×××¦×¢ ××¦×‘ ×œ××™×“×”, × ×¢×“×›×Ÿ ×’× ×©× ××ª ×”×¨×©×™××” ×”×“×—×•×¤×”
            if (document.getElementById('focusOverlay').style.display === 'flex') {
                renderFocusTasks();
            }
        });
    }

    // --- 4. ×”×©×œ××ª ××©×™××” ×•×¢×“×›×•×Ÿ × ×™×§×•×“ ---
    function completeTask(taskId) {
        // ×¢×“×›×•×Ÿ ×‘-Database
        db.ref(`classes/${currentUser.classCode}/tasks/${taskId}`).update({
            completed: true,
            completedBy: currentUser.name
        });

        // ×× ×™××¦×™×” ×§×˜× ×” ×©×œ ×”×¦×œ×—×”
        addPoints(100);
        confettiEffect(); // ×× ×™×© ×œ×š ×¡×¤×¨×™×™×ª ×§×•× ×¤×˜×™, ×›××Ÿ ×–×” ×”×–××Ÿ
    }

    // --- 5. × ×™×”×•×œ × ×’×Ÿ ×”×™×•×˜×™×•×‘ (YouTube Smart Player) ---
    function handleYTSearch() {
        const query = document.getElementById('ytQuery').value;
        if (!query) return;

        // ×”××¨×ª ×—×™×¤×•×© ×˜×§×¡×˜ ×œ×§×™×©×•×¨ ×™×•×˜×™×•×‘ (×—×™×¤×•×© ×‘×ª×•×š ×”-Embed)
        const embedUrl = `https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(query + " lofi study music")}&autoplay=1&enablejsapi=1`;
        document.getElementById('focusIframe').src = embedUrl;
    }

    // --- 6. ××¢×¨×›×ª ×©×¢×•×ª (Schedule) ---
    const weeklySchedule = {
        "A1": [
            { day: "×¨××©×•×Ÿ", lessons: ["××ª××˜×™×§×”", "×× ×’×œ×™×ª", "×”×™×¡×˜×•×¨×™×”", "×¡×¤×•×¨×˜"] },
            { day: "×©× ×™", lessons: ["×¤×™×–×™×§×”", "×¡×¤×¨×•×ª", "×œ×©×•×Ÿ", "×ª× ×š"] },
            { day: "×©×œ×™×©×™", lessons: ["××“×¢×™×", "××× ×•×ª", "×’×™××•×’×¨×¤×™×”", "×× ×’×œ×™×ª"] }
        ]
        // × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×›×™×ª×•×ª × ×•×¡×¤×•×ª ×›××Ÿ
    };

    function toggleSchedule() {
        const modal = document.getElementById('scheduleModal');
        const content = document.getElementById('scheduleContent');
        
        if (modal.classList.contains('hidden')) {
            const classSched = weeklySchedule[currentUser.classCode] || [];
            let html = `<h2 style="text-align:center; margin-bottom:20px;">ğŸ“… ××¢×¨×›×ª ×©×¢×•×ª - ×›×™×ª×” ${currentUser.classCode}</h2>`;
            
            classSched.forEach(d => {
                html += `
                    <div style="background:rgba(255,255,255,0.05); border-radius:15px; padding:15px; margin-bottom:10px; border-right:5px solid var(--accent-main);">
                        <b style="color:var(--accent-main)">×™×•× ${d.day}</b>
                        <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;">
                            ${d.lessons.map(l => `<span style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:8px; font-size:13px;">${l}</span>`).join('')}
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html || "<p style='text-align:center;'>××¢×¨×›×ª ×©×¢×•×ª ×œ× ×”×•×–× ×” ×œ×›×™×ª×” ×–×•</p>";
            modal.classList.remove('hidden');
        } else {
            modal.classList.add('hidden');
        }
    }

    // --- 7. ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×¡×™×•× ---
    function openFocusSetup() { document.getElementById('focusConfigModal').classList.remove('hidden'); }
    function closeFocusSetup() { document.getElementById('focusConfigModal').classList.add('hidden'); }
    
    function doLogout() {
        if(confirm("×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª× ×ª×§?")) {
            location.reload();
        }
    }

    function loadUserStats() {
        // ×›××Ÿ × ×™×ª×Ÿ ×œ××©×•×š ××”-DB × ×ª×•× ×™× ×¢×œ ×“×§×•×ª ×œ××™×“×” ×™×•××™×•×ª
        // ×›×¨×’×¢ × ×©×ª××© ×‘×¢×¨×š ×‘×¨×™×¨×ª ××—×“×œ
        dailyFocusMinutes = 15;
        updateStatsUI();
    }

    function updateStatsUI() {
        const progress = (dailyFocusMinutes / 60) * 100;
        document.getElementById('dailyBar').style.width = `${Math.min(progress, 100)}%`;
        document.getElementById('focusProgressText').innerText = `${dailyFocusMinutes} / 60`;
    }

/**
 * ============================================================
 * ×—×œ×§ 5: × ×™×”×•×œ ×œ×•×’×™×§×” ××ª×§×“××ª ×•×©×™×¨×•×ª×™ ××¢×¨×›×ª (×©×•×¨×•×ª 657-800+)
 * ============================================================
 */

// --- 1. ××¢×¨×›×ª ×”×•×“×¢×•×ª ×¦×¤×•×ª (Toast Notifications) ---
// ×¤×•× ×§×¦×™×” ×–×• ×××¤×©×¨×ª ×œ×”×¦×™×’ ×”×•×“×¢×•×ª ××¢×•×¦×‘×•×ª ×œ×ª×œ××™×“ ×‘×œ×™ ×œ×”×©×ª××© ×‘-Alert ××¢×¦×‘×Ÿ
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        padding: 15px 30px;
        border-radius: 50px;
        background: ${type === 'success' ? 'var(--success)' : 'var(--danger)'};
        color: white;
        font-weight: bold;
        box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        z-index: 20000;
        animation: slideUpToast 0.5s ease-out;
    `;
    toast.innerText = message;
    document.body.appendChild(toast);

    // ×”×¡×¨×” ××•×˜×•××˜×™×ª ××—×¨×™ 3 ×©× ×™×•×ª
    setTimeout(() => {
        toast.style.animation = 'fadeOutToast 0.5s ease-in';
        setTimeout(() => toast.remove(), 450);
    }, 3000);
}

// ×”×•×¡×¤×ª ×”×× ×™××¦×™×•×ª ×©×œ ×”-Toast ×œ-CSS ×‘×¦×•×¨×” ×“×™× ××™×ª
const styleSheet = document.createElement("style");
styleSheet.innerText = `
    @keyframes slideUpToast {
        from { bottom: -50px; opacity: 0; }
        to { bottom: 100px; opacity: 1; }
    }
    @keyframes fadeOutToast {
        from { opacity: 1; }
        to { opacity: 0; }
    }
`;
document.head.appendChild(styleSheet);

// --- 2. ×˜×™×¤×•×œ ××ª×§×“× ×‘×ª××¨×™×›×™× (Date Utilities) ---
// ×¤×•× ×§×¦×™×” ×œ×”××¨×” ×©×œ ×¤×•×¨××˜×™× ×©×•× ×™× ×©×œ ×ª××¨×™×›×™× ×›×“×™ ×œ×× ×•×¢ ×§×¨×™×¡×” ×©×œ ×”××™×•×Ÿ
function parseDateSafely(dateInput) {
    if (!dateInput) return new Date(8640000000000000); // ×ª××¨×™×š ×¨×—×•×§ ×××•×“ ×œ×¢×ª×™×“
    
    // × ×™×¡×™×•×Ÿ ×œ×–×”×•×ª ×× ××“×•×‘×¨ ×‘×¤×•×¨××˜ ISO ××• DD/MM/YYYY
    if (typeof dateInput === 'string' && dateInput.includes('/')) {
        const parts = dateInput.split('/');
        return new Date(parts[2], parts[1] - 1, parts[0]);
    }
    
    const parsed = new Date(dateInput);
    return isNaN(parsed.getTime()) ? new Date(8640000000000000) : parsed;
}

// --- 3. ×¢×“×›×•×Ÿ × ×™×§×•×“ ×‘-LocalStorage ×›×“×™ ×œ×©××•×¨ × ×ª×•× ×™× ×‘××¢×‘×¨ ×“×¤×™× ---
function syncPointsToStorage() {
    localStorage.setItem('userPoints', points);
    localStorage.setItem('focusMins', dailyFocusMinutes);
    localStorage.setItem('lastSync', new Date().toISOString());
}

// --- 4. ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×§×œ×˜ (Input Validation) ---
// ××‘×˜×™×— ×©×”×ª×œ××™×“ ×œ× ××–×™×Ÿ ×©×˜×•×™×•×ª ×‘×˜×™×™××¨
function validateFocusTime(mins) {
    if (mins < 1) {
        showToast("×”×™×™! ××™ ××¤×©×¨ ×œ×œ××•×“ ×¤×—×•×ª ××“×§×” ××—×ª...", 'error');
        return false;
    }
    if (mins > 180) {
        showToast("×•×•××•, ×–×” ×”××•×Ÿ! ×›×“××™ ×œ×¢×©×•×ª ×”×¤×¡×§×•×ª ××“×™ ×¤×¢×.", 'error');
        return false;
    }
    return true;
}

// --- 5. ××™×¨×•×¢×™ ××¢×¨×›×ª (Global Event Listeners) ---
// ×–×™×”×•×™ ×œ×—×™×¦×” ×¢×œ ××§×© Enter ×‘×—×™×¤×•×© ×™×•×˜×™×•×‘
document.getElementById('ytQuery').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        handleYTSearch();
    }
});

// ×¤×•× ×§×¦×™×™×ª ××ª×—×•×œ ××•×¨×—×‘×ª
function initializeAppServices() {
    console.log("Initializing Rally Matos Services...");
    
    // ×˜×¢×™× ×ª × ×™×§×•×“ ×©××•×¨
    const savedPoints = localStorage.getItem('userPoints');
    if (savedPoints) {
        points = parseInt(savedPoints);
        document.getElementById('pointsVal').innerText = `ğŸ’° ${points}`;
    }

    // ×‘×“×™×§×ª ×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜
    window.addEventListener('online', () => showToast("×”×—×™×‘×•×¨ ×—×–×¨! ×”××©×™××•×ª ××¡×•× ×›×¨× ×•×ª."));
    window.addEventListener('offline', () => showToast("×©×™× ×œ×‘: ××™×Ÿ ×—×™×‘×•×¨ ××™× ×˜×¨× ×˜.", 'error'));
}

// ×§×¨×™××” ×œ××ª×—×•×œ ×”×©×™×¨×•×ª×™×
initializeAppServices();

/** * ×¡×™×•× ×§×•×“ ×”××¤×œ×™×§×¦×™×” ×”××œ×
 * ×¡×š ×”×›×œ ×©×•×¨×•×ª ×‘×§×•×‘×¥ ×”×××•×—×“: ×›-812 ×©×•×¨×•×ª.
 */
    /** * ============================================================
 * ×—×œ×§ 6: ××‘×˜×—×ª × ×ª×•× ×™×, × ×™×”×•×œ ×©×’×™××•×ª ×•×¡×’×™×¨×ª ×”××¢×¨×›×ª
 * ============================================================
 */

// --- 1. ×˜×™×¤×•×œ ×‘×©×’×™××•×ª Firebase (Error Handler) ---
// ×¤×•× ×§×¦×™×” ×©××•×•×“××ª ×©×”××¤×œ×™×§×¦×™×” ×œ× ×§×•×¨×¡×ª ×× ×™×© ×‘×¢×™×” ×‘×©×¨×ª
function handleDataError(error) {
    console.error("Firebase Error Catch:", error);
    showToast("×”×™×™×ª×” ×‘×¢×™×” ×‘×¡× ×›×¨×•×Ÿ ×”× ×ª×•× ×™×. × ×¡×” ×œ×¨×¢× ×Ÿ.", "error");
}

// --- 2. ×× ×™×¢×ª ×™×¦×™××” ×‘×˜×¢×•×ª (Anti-Accident Exit) ---
// ××•×•×“× ×©×”×ª×œ××™×“ ×œ× ×¡×•×’×¨ ××ª ××¦×‘ ×”×œ××™×“×” ×‘×œ×™ ×›×•×•× ×” ×•××¤×¡×™×“ × ×§×•×“×•×ª
window.onbeforeunload = function() {
    if (document.getElementById('focusOverlay').style.display === 'flex') {
        return "××ª×” ×‘×××¦×¢ ×¡×©×Ÿ ×œ××™×“×”! ×× ×ª×¦× ×¢×›×©×™×•, ×”× ×§×•×“×•×ª ×œ× ×™×™×©××¨×•.";
    }
};

// --- 3. ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×©×™× ×•×™ ×¦×‘×¢ ×”×“×™×¨×•×’ (Dynamic UI) ---
// ××©× ×” ××ª ×¦×‘×¢ ×›×¤×ª×•×¨ ×”×¨×™×›×•×– ×œ×¤×™ ×›××•×ª ×”× ×§×•×“×•×ª ×©×œ ×”×ª×œ××™×“
function updateUIRank() {
    const focusBtn = document.querySelector('.btn-focus');
    if (points > 1000) {
        focusBtn.style.boxShadow = "0 0 20px #fbbf24";
        focusBtn.innerHTML = "<span>ğŸ’</span> ××¦×‘ ×œ××™×“×” ×œ××ª×§×“××™×";
    } else if (points > 500) {
        focusBtn.style.boxShadow = "0 0 15px #10b981";
    }
}

// --- 4. ×”×’×“×¨×•×ª × ×’×Ÿ ×™×•×˜×™×•×‘ ××ª×§×“××•×ª (IFrame API) ---
// ××•×•×“× ×©×”×¡×¨×˜×•×Ÿ ××¤×¡×™×§ ×›×©×™×•×¦××™× ×××¦×‘ ×¨×™×›×•×–
function stopAllMusic() {
    const iframe = document.getElementById('focusIframe');
    iframe.src = iframe.src; // ×˜×¨×™×§ ×¤×©×•×˜ ×œ×”×¤×¡×§×ª ×”× ×’×™× ×”
}

// --- 5. ×œ×•×’×™×§×ª ×¨×™×©×•× ×–×× ×™ (Logging) ---
// ×¢×•×–×¨ ×œ×š ×œ×“×‘×’ ××ª ×”××¤×œ×™×§×¦×™×” ×‘××™×“×” ×•××©×”×• ×œ× ×¢×•×‘×“
function logAppStatus() {
    const status = {
        user: currentUser ? currentUser.name : "Not Logged In",
        class: currentUser ? currentUser.classCode : "None",
        tasksCount: tasks.length,
        points: points,
        time: new Date().toLocaleTimeString()
    };
    console.table(status);
}

// ×”×¤×¢×œ×ª ×œ×•×’ ×¡×˜×˜×•×¡ ×›×œ 5 ×“×§×•×ª
setInterval(logAppStatus, 300000);

// --- 6. ×¡×’×™×¨×•×ª ×¡×•×¤×™×•×ª ×©×œ ×”××¢×¨×›×ª ---

// ××ª×—×•×œ ××™×¨×•×¢×™× × ×•×¡×¤×™×
document.addEventListener('DOMContentLoaded', () => {
    console.log("Rally Matos UI fully loaded and secured.");
    // ×‘×“×™×§×” ×× ×™×© × ×ª×•× ×™× ×‘-Cache ×›×“×™ ×œ×”××™×¥ ××ª ×”×˜×¢×™× ×”
    const cachedTasks = localStorage.getItem('lastTasks');
    if (cachedTasks) {
        tasks = JSON.parse(cachedTasks);
        renderTasks();
    }
});

/** * ×¡×•×£ ×”×§×•×“ ×”××œ× ×•×”××•×¨×—×‘ ×©×œ ×¨××œ×™ ××˜×•"×¡ 2026.
 * ×”×§×•×“ ×›×•×œ×œ ×›×¢×ª:
 * - ××¢×¨×›×ª ××©×™××•×ª ×××•×™× ×ª ×“×—×•×¤×”
 * - × ×’×Ÿ ×™×•×˜×™×•×‘ ×—×›×
 * - ×˜×™×™××¨ ×¨×™×›×•×– ×¢× ×”×’×“×¨×•×ª ××™×©×™×•×ª
 * - ××¢×¨×›×ª × ×§×•×“×•×ª × ×©××¨×ª
 * - ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×•×ª×¦×•×’×ª Toasts
 */

<style>
    /* ×”×’×“×¨×•×ª ×œ×× ×™×¢×ª ×–×•× ××•×˜×•××˜×™ ×‘×©×“×•×ª ×§×œ×˜ ×‘××™×™×¤×•×Ÿ */
    @media screen and (max-width: 768px) {
        input[type="text"], 
        input[type="number"], 
        select {
            font-size: 16px !important;
        }
        
        .timer-display {
            font-size: 65px; /* ×”×§×˜× ×” ×§×œ×” ×œ××¡×›×™× ×§×˜× ×™× */
        }
        
        .glass-panel {
            padding: 15px;
            border-radius: 20px;
        }
    }

    /* ×¢×™×¦×•×‘ ×¤×¡ ×”×’×œ×™×œ×” (Scrollbar) ×©×™×™×¨××” ××•×“×¨× ×™ */
    ::-webkit-scrollbar {
        width: 6px;
    }
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
    }
    ::-webkit-scrollbar-thumb {
        background: var(--accent-main);
        border-radius: 10px;
    }

    /* ××¤×§×˜ ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨×™× */
    .btn-primary:active, .btn-focus:active {
        transform: scale(0.98);
        filter: brightness(0.9);
    }

    /* ×ª×¦×•×’×ª "××™×Ÿ ××©×™××•×ª" */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        opacity: 0.5;
        font-style: italic;
    }
</style>

<script>
    /**
     * ×¤×•× ×§×¦×™×” ××—×¨×•× ×” ×‘×”×—×œ×˜: ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×ª×¦×•×’×”
     * ××•×•×“××ª ×©×›×œ ×”××œ×× ×˜×™× ×”×§×¨×™×˜×™×™× ×§×™×™××™× ×‘×“×£ ×œ×¤× ×™ ×”×”×¤×¢×œ×”
     */
    function finalSanityCheck() {
        const requiredElements = [
            'loginView', 'mainView', 'focusOverlay', 
            'activeTasksList', 'timerDigits', 'focusIframe'
        ];
        
        requiredElements.forEach(id => {
            if (!document.getElementById(id)) {
                console.error(`Missing Critical Element: ${id}`);
            }
        });
        
        console.log("Rally Matos 2026: Ready for takeoff. Lines: 849+");
    }

    // ×”×¤×¢×œ×” ×‘×©× ×™×™×” ×©×”×“×£ ××•×›×Ÿ
    window.addEventListener('load', finalSanityCheck);
/**
 * ============================================================
 * ×—×œ×§ 7: ××¢×¨×›×ª ××‘×˜×—×”, × ×™×”×•×œ ×©×’×™××•×ª ×•×¡×’×™×¨×•×ª ×¡×•×¤×™×•×ª
 * ============================================================
 */

// --- 1. ××¢×¨×›×ª ×”×ª×¨××•×ª ××¢×•×¦×‘×ª (Custom Alerts) ---
// ××—×œ×™×£ ××ª ×”-Alert ×”××™×•×©×Ÿ ×©×œ ×”×“×¤×“×¤×Ÿ ×‘×”×•×“×¢×” ×™×¤×” ×©×¦×¤×” ××œ××¢×œ×”
function notifyUser(msg, type = 'info') {
    const banner = document.createElement('div');
    banner.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 15px 30px;
        border-radius: 15px;
        background: ${type === 'error' ? 'var(--danger)' : 'var(--accent-main)'};
        color: white;
        font-weight: bold;
        z-index: 20000;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        animation: slideDownFade 0.5s ease-out;
    `;
    banner.innerText = msg;
    document.body.appendChild(banner);

    // ×”×¡×¨×” ××•×˜×•××˜×™×ª ×©×œ ×”×”×ª×¨××”
    setTimeout(() => {
        banner.style.animation = 'slideUpFade 0.5s ease-in forwards';
        setTimeout(() => banner.remove(), 500);
    }, 4000);
}

// ×”×•×¡×¤×ª ×”×× ×™××¦×™×•×ª ×œ×”×ª×¨××•×ª
const extraStyles = document.createElement('style');
extraStyles.innerText = `
    @keyframes slideDownFade {
        from { top: -100px; opacity: 0; }
        to { top: 20px; opacity: 1; }
    }
    @keyframes slideUpFade {
        from { top: 20px; opacity: 1; }
        to { top: -100px; opacity: 0; }
    }
`;
document.head.appendChild(extraStyles);

// --- 2. ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×—×™×‘×•×¨ (Network Handler) ---
window.addEventListener('offline', () => {
    notifyUser("××•×¤×¡! × ×¨××” ×©××™×Ÿ ×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜. ×”××©×™××•×ª ×œ× ×™×¡×•× ×›×¨× ×•.", "error");
});

window.addEventListener('online', () => {
    notifyUser("×”×—×™×‘×•×¨ ×—×–×¨! ××¢×“×›×Ÿ × ×ª×•× ×™×...", "success");
    if(currentUser) loadTasks();
});

// --- 3. ×¤×•× ×§×¦×™×™×ª "×× ×™×¢×ª ×¡×’×™×¨×” ×‘×˜×¢×•×ª" ---
// ××‘×˜×™×— ×©×ª×œ××™×“ ×œ× ×™×¡×’×•×¨ ××ª ×”×“×£ ×‘×××¦×¢ ×œ××™×“×” ×•×™××‘×“ ××ª ×–××Ÿ ×”×¨×™×›×•×– ×©×œ×•
window.onbeforeunload = function() {
    if (document.getElementById('focusOverlay').style.display === 'flex') {
        return "×”×™×™! ××ª×” ×‘×××¦×¢ ×¡×©×Ÿ ×œ××™×“×”. ×× ×ª×¦× ×¢×›×©×™×•, ×–××Ÿ ×”×¨×™×›×•×– ×•×”× ×§×•×“×•×ª ×œ× ×™×™×©××¨×•.";
    }
};

// --- 4. ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×—×™×©×•×‘ ××—×•×–×™× (Progress Calculator) ---
function calculateCompletionRate() {
    if (tasks.length === 0) return 0;
    const completed = tasks.filter(t => t.completed).length;
    return Math.round((completed / tasks.length) * 100);
}

// --- 5. ××ª×—×•×œ ×”××¢×¨×›×ª (Final Initialization) ---
document.addEventListener('DOMContentLoaded', () => {
    console.log("%c Rally Matos v3.0 - System Online ", "background: #6366f1; color: white; font-weight: bold;");
    
    // ×‘×“×™×§×” ×× ×”××©×ª××© ×›×‘×¨ ××—×•×‘×¨ (×©××™×¨×” ×‘-Session)
    const savedName = localStorage.getItem('student_name');
    const savedClass = localStorage.getItem('student_class');
    
    if (savedName && savedClass) {
        document.getElementById('inputName').value = savedName;
        document.getElementById('inputClass').value = savedClass;
        processLogin(); // ×”×ª×—×‘×¨×•×ª ××•×˜×•××˜×™×ª
    }
});

// --- 6. ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ× ×™×§×•×™ × ×ª×•× ×™× (Reset) ---
function resetSystemData() {
    if(confirm("×–×” ×™××—×§ ××ª ×›×œ ×”××™×“×¢ ×”×©××•×¨ ×•×™×•×¦×™× ××•×ª×š ××”××¢×¨×›×ª. ×œ×”××©×™×š?")) {
        localStorage.clear();
        location.reload();
    }
}

/** * ============================================================
 * ×¡×™×•× ×§×•×“ ××§×•×¨ - ×¨××œ×™ ××˜×•"×¡ 2026
 * ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª ×œ××¢×¨×›×ª ×”×œ××™×“×” ×”×—×›××”.
 * ============================================================
 */
</script>

</body>
</html>
